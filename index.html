<html>
	<head>
		<link rel="stylesheet" type="text/css" href="style/style.css">
		<script src="js/lib/three.min.js"></script>
		<script src="js/lib/OrbitControls.js"></script>
		<script src="js/lib/jquery-3.1.1.min.js"></script>
	</head>
	<body>
		<script type="x-shader/x-vertex" id="vertexShader">
			varying vec2 vUv;
			  varying vec3 vNormal;
			  varying vec3 vPosition;
			  uniform sampler2D webcam;
		
			  void main()
			  {
			  	vec3 camColor = texture2D( webcam, vUv ).rgb;
			    vUv = uv;
			    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
			    vNormal = normal;

			     vec4 texel;
			     //Read the texture offset. Offset in the z direction only
			     texel = texture2DLod( webcam, vUv , 0.0);
			     vec3 newVertex = vec3(1.,1.,1.);
			     newVertex.x += texel.z*2.;
			     gl_Position = projectionMatrix * mvPosition;
			    //gl_Position = projectionMatrix * mvPosition + vec4(newVertex,1.0);
			    vPosition = newVertex;
			  }
		</script>
		<script type="x-shader/x-fragment" id="fragmentShader">
		float map(float x, float in_min, float in_max, float out_min, float out_max)
		{
		  return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
		}

			uniform sampler2D webcam;
			varying vec2 vUv;
			varying vec3 vNormal;
			varying vec3 vPosition;
			void main( void ) {     		
				vec3 camColor = texture2D( webcam, vUv ).rgb;

				float rOffset = camColor.r;
				float gOffset = map(camColor.g,0.,1.,0.,0.707106781186548);
				float bOffset = map(camColor.b,0.,1.,0.,0.707106781186548);

				// float redComp = texture2D( webcam, vUv+vec2(0.,rOffset) ).r;
				// float greenComp = texture2D( webcam, vUv+vec2(gOffset,-gOffset) ).g;
				// float blueComp = texture2D( webcam, vUv+vec2(-bOffset,-bOffset) ).b;
				// vec3 newCamColor = vec3(redComp,greenComp,blueComp);
				vec2 redSample = vec2(0.,rOffset);
				vec2 greenSample = vec2(gOffset,-gOffset);
				vec2 blueSample = vec2(-bOffset,-bOffset);

				vec2 combinedOffset = (redSample+greenSample+blueSample)/5.;

				vec3 newCamColor = texture2D( webcam, vUv+(combinedOffset)).rgb;
				//vec3 lightPosition = vec3(1.,0.,0.2);
				//float lightness = dot(normalize(lightPosition),vNormal)+1./2.;
				gl_FragColor = vec4( newCamColor, 1.0 );
			}
		</script>
		<script src="js/script.js"></script>
	</body>
</html>
